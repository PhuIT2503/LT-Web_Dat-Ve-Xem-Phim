<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Vé - Web Xem Phim</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* === NỘI DUNG TỪ frontend/css/variables.css === */
        :root {
            --primary-color: #e50914; /* Màu đỏ của Netflix */
            --dark-color: #141414;      /* Màu nền chính */
            --light-dark-color: #181818; /* Màu nền phụ (cho card) */
            --light-color: #ffffff;     /* Màu chữ chính */
            --grey-color: #8c8c8c;      /* Màu chữ phụ */
            
            --font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --header-height: 70px;
        }

        /* === NỘI DUNG TỪ frontend/css/style.css === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--dark-color);
            color: var(--light-color);
            line-height: 1.6;
        }
        a {
            color: var(--light-color);
            text-decoration: none;
        }
        ul {
            list-style: none;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        main {
            padding-top: var(--header-height); 
        }
        .movie-list-container {
            padding: 20px 4%;
        }
        .movie-list-container h2 {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .movie-card-link {
            text-decoration: none;
            color: inherit;
        }

        /* === NỘI DUNG TỪ frontend/css/components.css === */
        /* --- 1. Header --- */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0));
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 4%;
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        .main-header.scrolled {
            background-color: var(--light-dark-color);
        }
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        .main-nav ul {
            display: flex;
        }
        .main-nav li {
            margin-left: 20px;
        }
        .main-nav a:hover {
            color: var(--grey-color);
        }
        .search-box {
            border: 1px solid var(--light-color);
            border-radius: 4px;
            padding: 5px 10px;
            background-color: rgba(0,0,0,0.5);
        }
        .search-box input {
            background: transparent;
            border: none;
            color: var(--light-color);
            outline: none;
        }
        .search-box i {
            color: var(--grey-color);
        }
        /* --- 2. Banner Slider (style.css đã có, nhưng components.css có chi tiết hơn) --- */
        .banner-slider-container {
            height: 56.25vw; /* Tỷ lệ 16:9 */
            max-height: 80vh; /* Chiều cao tối đa */
            position: relative;
            background-size: cover;
            background-position: center top;
            display: flex;
            align-items: flex-end; /* Căn nội dung xuống dưới */
            padding: 0 4% 10%;
        }
        .banner-slider-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(20,20,20,1) 10%, rgba(20,20,20,0) 50%);
        }
        .banner-content {
            position: relative;
            z-index: 10;
            max-width: 50%;
        }
        .banner-content h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
        }
        .banner-content p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            transition: opacity 0.3s ease;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--light-color);
        }
        .btn-secondary {
            background-color: rgba(109, 109, 110, 0.7);
            color: var(--light-color);
        }
        /* --- 3. Movie Card --- */
        .movie-card {
            background-color: var(--light-dark-color);
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .movie-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .movie-card-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        .movie-card-info {
            padding: 15px;
        }
        .movie-card-info h4 {
            font-size: 1.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 5px;
        }
        .movie-card-info p {
            font-size: 0.9rem;
            color: var(--grey-color);
        }
        /* --- 4. Footer --- */
        .main-footer {
            border-top: 1px solid var(--grey-color);
            padding: 40px 4%;
            margin-top: 40px;
            text-align: center;
            color: var(--grey-color);
        }
        /* --- 5. Modal Trailer --- */
        .modal-trailer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-trailer.active {
            display: flex;
        }
        .modal-content {
            position: relative;
            width: 80%;
            max-width: 900px;
        }
        .modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            font-size: 2rem;
            color: var(--light-color);
            cursor: pointer;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* === NỘI DUNG CSS MỚI CHO TRANG BOOKING === */
        .booking-container {
            display: flex;
            flex-wrap: wrap; 
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 4%;
            gap: 30px;
            color: #fff;
        }
        .booking-main {
            flex: 1;
            min-width: 600px;
            background-color: var(--light-dark-color);
            padding: 30px;
            border-radius: 8px;
        }
        .booking-main h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--grey-color);
            padding-bottom: 10px;
        }
        .date-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px; /* Giảm margin */
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .date-item {
            background-color: var(--dark-color);
            border: 1px solid var(--grey-color);
            color: var(--light-color);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            min-width: 100px;
            text-align: center;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .date-item:hover {
            background-color: #333;
        }
        .date-item.selected {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
            font-weight: bold;
        }

        /* === CSS MỚI: Dải chọn suất chiếu === */
        .showtime-title {
            font-size: 1.2rem;
            color: var(--grey-color);
            margin-top: 20px;
            margin-bottom: 15px;
        }
        .showtime-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap; /* Cho phép xuống hàng */
        }
        .time-item {
            background-color: var(--dark-color);
            border: 1px solid var(--grey-color);
            color: var(--light-color);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s, border-color 0.3s;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .time-item:hover {
            background-color: #333;
        }
        .time-item.selected {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
        }
        /* === Kết thúc CSS MỚI === */

        .screen {
            background-color: #fff;
            color: #000;
            padding: 10px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        .seat-map {
            display: grid;
            grid-template-columns: repeat(14, 1fr); 
            gap: 8px;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }
        .seat {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
            transition: background-color 0.2s;
            background-color: #444;
            border: 1px solid #666;
        }
        .seat.available:hover {
            background-color: #666;
        }
        .seat.booked {
            background-color: #222;
            border-color: #333;
            color: #666;
            cursor: not-allowed;
        }
        .seat.selected {
            background-color: var(--primary-color);
            border-color: #ff5555;
            font-weight: bold;
        }
        .seat.gap {
            visibility: hidden;
            cursor: default;
        }
        .seat-legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            border-top: 1px solid var(--grey-color);
            padding-top: 20px;
        }
        .legend-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* === CSS MỚI: Phần chọn Combo Bắp/Nước === */
        .combo-section {
            margin-top: 30px;
            border-top: 1px solid var(--grey-color);
            padding-top: 20px;
        }
        .combo-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .combo-item {
            display: flex;
            align-items: center;
            background-color: var(--dark-color);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .combo-item img {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            margin-right: 15px;
            object-fit: cover;
        }
        .combo-info {
            flex: 1; /* Đẩy bộ đếm sang phải */
        }
        .combo-info h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .combo-info p {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
        }
        .combo-quantity-selector {
            display: flex;
            align-items: center;
        }
        .quantity-btn {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        .quantity-btn:disabled {
             background-color: #555;
             cursor: not-allowed;
        }
        .quantity-display {
            width: 40px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--light-color);
        }
        /* === Kết thúc CSS MỚI === */


        .booking-sidebar {
            flex-basis: 350px;
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        .movie-info-card {
            background-color: var(--light-dark-color);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .movie-info-card img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .movie-info-content {
            padding: 20px;
        }
        .movie-info-content h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .movie-info-content p {
            font-size: 0.9rem;
            color: var(--grey-color);
            margin-bottom: 5px;
        }
        .customer-info-box, .summary-box {
            background-color: var(--light-dark-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .customer-info-box h3, .summary-box h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--grey-color);
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid var(--grey-color);
            background-color: var(--dark-color);
            color: var(--light-color);
            font-size: 1rem;
        }

        /* === CSS CẬP NHẬT: Tóm tắt đặt vé === */
        .summary-details {
            border-bottom: 1px dashed var(--grey-color);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .summary-details:last-of-type {
            border-bottom: none;
        }
        .summary-box h3 {
            border-bottom: 1px solid var(--grey-color);
            padding-bottom: 10px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1rem; /* Giảm font size cho chi tiết */
        }
        .summary-item span:first-child {
            color: var(--grey-color);
            margin-right: 10px;
        }
        .summary-item span:last-child {
            font-weight: 600;
            color: var(--light-color);
            white-space: nowrap; /* Tránh vỡ dòng */
        }
        /* CSS cho mục ghế */
        #selected-list {
            color: var(--light-color);
            font-weight: 600;
            word-break: break-all; /* Xuống hàng nếu quá nhiều ghế */
        }
        /* CSS cho danh sách combo (JS tạo ra) */
        #combo-summary-list .summary-item span:first-child {
            color: var(--light-color); /* Màu trắng cho tên combo */
        }

        .summary-total {
            border-top: 1px solid var(--grey-color);
            padding-top: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        /* === Kết thúc CSS CẬP NHẬT === */


        #confirm-booking {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
        }
        #booking-message {
            margin-top: 15px;
            color: #4caf50;
            font-weight: bold;
            text-align: center;
        }
        
        /* === NỘI DUNG TỪ frontend/css/responsive.css === */
        @media (max-width: 768px) {
            .main-nav {
                display: none;
            }
            .banner-content {
                max-width: 80%;
            }
            .banner-content h1 {
                font-size: 2.5rem;
            }
            .movie-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            .movie-card-img {
                height: 220px;
            }
        }
        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }
            .search-box {
                display: none;
            }
            .banner-content h1 {
                font-size: 2rem;
            }
            .banner-content p {
                display: none;
            }
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            .movie-grid {
                grid-template-columns: repeat(2, 1fr); 
            }
            .movie-card-img {
                height: 250px;
            }
        }
        
        /* === CSS RESPONSIVE RIÊNG CỦA BOOKING (TỪ booking.css) === */
        @media (max-width: 1024px) {
            .booking-main {
                min-width: 100%;
                order: 1;
            }
            .booking-sidebar {
                flex-basis: 100%;
                position: static;
                order: 2;
            }
            .seat-map {
                grid-template-columns: repeat(14, 1fr);
                gap: 5px;
            }
            .seat {
                font-size: 0.6rem;
            }
        }
        @media (max-width: 640px) { /* Thêm breakpoint cho combo */
             .booking-main {
                padding: 15px;
            }
            .combo-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .combo-quantity-selector {
                margin-top: 10px;
                align-self: flex-end; /* Đẩy bộ đếm sang phải */
            }
        }
        @media (max-width: 480px) {
            .seat-map {
                gap: 3px;
            }
            .seat {
                border-radius: 4px;
            }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <a href="index.html" class="logo">CGV</a>
        <nav class="main-nav">
            <ul>
                <li><a href="index.html">Trang Chủ</a></li>
                <li><a href="movies.html">Phim Lẻ</a></li>
                <li><a href="movies.html">Phim Bộ</a></li>
                <li><a href="movies.html">Mới & Phổ Biến</a></li>
            </ul>
        </nav>
        <div class="search-box">
            <input id="header-search-input" type="text" placeholder="Tìm kiếm...">
            <i id="header-search-btn" class="fa-solid fa-magnifying-glass" title="Tìm kiếm"></i>
        </div>
    </header>

    <main>
        <div class="booking-container">
            
            <section class="booking-main">
                <h2 id="booking-title">Chọn Ngày & Chỗ Ngồi</h2>
                
                <div id="date-selector" class="date-selector" aria-label="Chọn ngày">
                    </div>
                
                <h3 class="showtime-title">Chọn Suất Chiếu (Giả lập)</h3>
                <div id="showtime-selector" class="showtime-selector">
                    </div>
                
                <div class="screen">Màn hình</div>
                
                <div id="seat-map" class="seat-map">
                    Đang tải sơ đồ chỗ ngồi...
                </div>
                
                <div class="seat-legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background-color: #444; border: 1px solid #666;"></div> Trống
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background-color: #222; border-color: #333;"></div> Đã đặt
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background-color: var(--primary-color); border-color: #ff5555;"></div> Đang chọn
                    </div>
                </div>

                <div class="combo-section">
                    <h3>Chọn Bắp & Nước</h3>
                    <div id="combo-list-container">
                        </div>
                </div>
                </section>

            <aside class="booking-sidebar">
                
                <div class="movie-info-card" id="movie-info-placeholder">
                    <img id="movie-poster" src="" alt="Poster phim" style="display: none;">
                    <div class="movie-info-content">
                        <h3 id="movie-title">Đang tải...</h3>
                        <p id="movie-year-rating">Năm: ... | Rating: ...</p>
                        <p id="movie-duration-genre">Thời lượng: ... | Thể loại: ...</p>
                    </div>
                </div>

                <div class="customer-info-box">
                    <h3>Thông tin của bạn</h3>
                    <div class="form-group">
                        <label for="cust-name">Họ và tên</label>
                        <input id="cust-name" type="text" placeholder="Nguyễn Văn A">
                    </div>
                    <div class="form-group">
                        <label for="cust-phone">Số điện thoại</label>
                        <input id="cust-phone" type="text" placeholder="0901234567">
                    </div>
                </div>

                <div class="summary-box">
                    <h3>Tóm tắt đặt vé</h3>
                    
                    <div class="summary-details">
                        <div class="summary-item">
                            <span>Ghế: <span id="selected-list">(chưa chọn)</span></span>
                            <span id="selected-seats-total">0 VND</span>
                        </div>
                    </div>
                    
                    <div class="summary-details" id="combo-summary-list">
                        </div>

                    <div class="summary-total">
                        <span>Tổng cộng:</span>
                        <span id="total-price">0 VND</span>
                    </div>
                    
                    <button id="confirm-booking" class="btn btn-primary" style="margin-top: 20px;">Xác nhận đặt vé</button>
                    <div id="booking-message"></div>
                </div>
                </aside>
        </div>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 Web Xem Phim. Mọi bản quyền thuộc về bạn.</p>
    </footer>

    <div class="modal-trailer" id="trailer-modal">
        <div class="modal-content">
            <span class="modal-close" id="modal-close-btn">&times;</span>
            <div class="video-container">
                <iframe id="trailer-iframe" 
                        src="" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>


    <script>
        /* === NỘI DUNG TỪ frontend/js/mock-data.js === */
        const mockData = {
            banner: {
                id: 99,
                title: "Mưa Đỏ",
                year: 2025,
                description: "Lấy bối cảnh 81 ngày đêm khốc liệt tại Thành Cổ Quảng Trị năm 1972, Mưa Đỏ là câu chuyện hư cấu, theo chân một tiểu đội gồm những người lính trẻ tuổi, đầy nhiệt huyết, chiến đấu và bám trụ tại trận địa lịch sử này.",
                imageUrl: "https://imgchinhsachcuocsong.vnanet.vn/MediaUpload/Org/2025/07/23/204219-z6833331728306_9920591c2fadf96b8ec838e4967f44a4.jpg", 
                trailerUrl: "https://www.youtube.com/embed/BD6PoZJdt_M",
                duration: "120 phút",
                rating: "T18",
                genre: "Chiến tranh, Lịch sử",
                director: "Nguyễn Quang Dũng",
                cast: "Nhiều diễn viên trẻ"
            },
            newMovies: [
                {
                    id: 1,
                    title: "Lật Mặt 7: Một Điều Ước",
                    year: 2024,
                    description: "Phim xoay quanh câu chuyện của bà Hai (Thanh Hiền) và bốn người con. Khi bà Hai không may gặp nạn, cần người chăm sóc, bốn người con đùn đẩy nhau. Câu chuyện đặt ra câu hỏi về lòng hiếu thảo và tình cảm gia đình.",
                    imageUrl: "https://photo-baomoi.bmcdn.me/w700_r1/2024_03_13_17_48553023/057ac6914bdda283fbcc.jpg",
                    trailerUrl: "https://www.youtube.com/embed/d1ZHdosjNX8",
                    duration: "138 phút",
                    rating: "T13",
                    genre: "Gia đình, Chính kịch",
                    director: "Lý Hải",
                    cast: "Thanh Hiền, Trương Minh Cường, Đinh Y Nhung, Quách Ngọc Tuyên"
                },
                 {
                    id: 2,
                    title: "Gặp Lại Chị Bầu",
                    year: 2024,
                    description: "Phúc, một thanh niên có quá khứ bất hảo, cùng bạn bè lập nghiệp ở xóm trọ. Anh gặp Huyền, một cô gái tốt bụng. Tình yêu của họ nảy nở giữa những khó khăn, và bí mật về quá khứ của Huyền dần được hé lộ.",
                    imageUrl: "https://tse3.mm.bing.net/th/id/OIP.xrGKhbdzKrWVQ2urtnnk-AHaK_?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/8WS_CiekZLc",
                    duration: "110 phút",
                    rating: "T16",
                    genre: "Hài, Tình cảm",
                    director: "Nhất Trung",
                    cast: "Anh Tú, Diệu Nhi, Lê Giang, Ngọc Phước"
                },
                {
                    id: 3,
                    title: "Nhà Gia Tiên",
                    year: 2025,
                    description: "Câu chuyện về một gia đình gốc Việt tại Mỹ và những xung đột thế hệ. Phim khám phá sự khác biệt văn hóa, kỳ vọng của cha mẹ và ước mơ của con cái trong bối cảnh hiện đại.",
                    imageUrl: "https://st.download.com.vn/data/image/2025/02/14/nha-gia-tien.jpg",
                    trailerUrl: "https://www.youtube.com/embed/aR2lnpCLqUk",
                    duration: "95 phút",
                    rating: "T13",
                    genre: "Gia đình, Hài",
                    director: "Trần Hữu Tấn",
                    cast: "Lê Khanh, Hồng Đào, Thái Hòa, Tuấn Trần"
                },
                {
                    id: 4,
                    title: "Thám Tử Kiên: Kỳ Án Không Đầu",
                    year: 2025,
                    description: "Một thám tử tư tài ba nhưng lập dị điều tra một vụ án mạng bí ẩn nơi nạn nhân bị mất đầu. Anh phải chạy đua với thời gian để tìm ra hung thủ trước khi hắn ra tay lần nữa.",
                    imageUrl: "https://tse1.mm.bing.net/th/id/OIP.4HedOsPiqdgGJBNfuEHYUQHaKl?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/QiXNbEKF3U0",
                    duration: "115 phút",
                    rating: "T18",
                    genre: "Trinh thám, Kinh dị",
                    director: "Victor Vũ",
                    cast: "Hứa Vĩ Văn, Trúc Anh, Kaity Nguyễn"
                },
                {
                    id: 5,
                    title: "Nhà Bà Nữ",
                    year: 2023,
                    description: "Phim xoay quanh gia đình bà Nữ, chủ một quán bánh canh cua, và những mâu thuẫn thế hệ gay gắt. Câu chuyện khai thác áp lực gia đình, tình yêu và sự tha thứ.",
                    imageUrl: "https://th.bing.com/th/id/R.4484bb72cef55c45590763e3d98772ed?rik=KN1P4v1nfCF6sA&pid=ImgRaw&r=0",
                    trailerUrl: "https://www.youtube.com/embed/4peQFKutH34",
                    duration: "135 phút",
                    rating: "T16",
                    genre: "Chính kịch, Gia đình",
                    director: "Trấn Thành",
                    cast: "Trấn Thành, Lê Giang, Uyển Ân, Song Luân"
                }
            ],
            trendingMovies: [
                {
                    id: 6,
                    title: "Lật Mặt 6: Tấm Vé Định Mệnh",
                    year: 2023,
                    description: "Một nhóm bạn thân trúng số độc đắc. Tấm vé đã thay đổi cuộc đời họ, nhưng cũng kéo theo những âm mưu, sự phản bội và cái chết. Tình bạn của họ bị thử thách bởi lòng tham.",
                    imageUrl: "https://tse3.mm.bing.net/th/id/OIP.gwUCRkCrlItYPT7oEALsKAHaLH?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/ns9f92mR6bM",
                    duration: "132 phút",
                    rating: "T18",
                    genre: "Hành động, Giật gân",
                    director: "Lý Hải",
                    cast: "Quốc Cường, Trung Dũng, Huy Khánh, Thanh Thức"
                },
                {
                    id: 7,
                    title: "Đất Rừng Phương Nam",
                    year: 2023,
                    description: "Phiên bản điện ảnh kể về hành trình phiêu lưu của cậu bé An đi tìm cha qua các tỉnh miền Tây Nam Bộ trong thời kỳ kháng chiến chống Pháp. Phim tái hiện vẻ đẹp hùng vĩ của thiên nhiên và con người nơi đây.",
                    imageUrl: "https://tse1.mm.bing.net/th/id/OIP.fAgqmbugm7Fvfh9qY37GkwHaJQ?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/D0_w81Q-P3M",
                    duration: "110 phút",
                    rating: "T13",
                    genre: "Phiêu lưu, Gia đình",
                    director: "Nguyễn Quang Dũng",
                    cast: "Hạo Khang, Trấn Thành, Tuấn Trần, Hồng Ánh"
                },
                {
                    id: 8,
                    title: "Em và Trịnh",
                    year: 2022,
                    description: "Bộ phim tái hiện cuộc đời và những mối tình của nhạc sĩ Trịnh Công Sơn. Phim là bức tranh lãng mạn về âm nhạc, tình yêu và những nàng thơ đã đi qua cuộc đời ông.",
                    imageUrl: "https://tintuc-divineshop.cdn.vccloud.vn/wp-content/uploads/2022/06/review-em-va-trinh_62a329726ea9a.jpeg",
                    trailerUrl: "https://www.youtube.com/embed/zzik4JB9D1Q",
                    duration: "136 phút",
                    rating: "T13",
                    genre: "Tiểu sử, Lãng mạn",
                    director: "Phan Gia Nhật Linh",
                    cast: "Avin Lu, Bùi Lan Hương, Hoàng Hà, Lan Thy"
                },
                {
                    id: 9,
                    title: "Con Nhót Mót Chồng",
                    year: 2023,
                    description: "Câu chuyện hài hước và cảm động về Nhót, một người phụ nữ 'quá lứa' sống cùng người cha nghiện rượu. Hành trình tìm chồng của Nhót cũng là hành trình cô hàn gắn tình cảm với cha mình.",
                    imageUrl: "https://tse1.explicit.bing.net/th/id/OIP.ycZsFjfDFuRrzw-EGbeosAHaJQ?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/e7KHOQ-PalqY",
                    duration: "90 phút",
                    rating: "T16",
                    genre: "Hài, Gia đình",
                    director: "Vũ Ngọc Đãng",
                    cast: "Thu Trang, Thái Hòa, Tiến Luật"
                },
                {
                    id: 10,
                    title: "Siêu Lừa Gặp Siêu Lầy",
                    year: 2023,
                    description: "Khoa, một tên lừa đảo, đến Phú Quốc với ý định lừa đảo. Anh gặp Tú, một tên lừa đảo 'lầy lội' khác. Cả hai hợp tác trong nhiều phi vụ dở khóc dở cười trước khi đối mặt với một đối thủ lớn.",
                    imageUrl: "https://tse1.mm.bing.net/th/id/OIP.wqDOC6JOXfblf2BIRrMLlQHaK4?rs=1&pid=ImgDetMain&o=7&rm=3",
                    trailerUrl: "https://www.youtube.com/embed/oNqD2HxBUq4",
                    duration: "112 phút",
                    rating: "T16",
                    genre: "Hài, Hành động",
                    director: "Võ Thanh Hòa",
                    cast: "Anh Tú, Mạc Văn Khoa, Ngọc Phước"
                }
            ]
        };

        /* === NỘI DUNG TỪ frontend/js/booking.js (ĐÃ CẬP NHẬT) === */
        document.addEventListener('DOMContentLoaded', () => {
            initializeBookingPage();
        });

        async function initializeBookingPage() {
            try {
                addHeaderScrollEffect();
                setupModalListeners();
                setupHeaderSearchListeners();

                const params = new URLSearchParams(window.location.search);
                const movieId = params.get('id');
                if (!movieId) {
                    document.getElementById('booking-title').textContent = 'Lỗi: Không có phim để đặt vé';
                    return;
                }

                const movie = findMovieInMock(movieId);
                if (movie) {
                    document.getElementById('movie-poster').src = movie.imageUrl;
                    document.getElementById('movie-poster').style.display = 'block';
                    document.getElementById('movie-title').textContent = movie.title;
                    document.getElementById('movie-year-rating').textContent = `Năm: ${movie.year || 'N/A'} | Rating: ${movie.rating || 'N/A'}`;
                    document.getElementById('movie-duration-genre').textContent = `Thời lượng: ${movie.duration || 'N/A'} | Thể loại: ${movie.genre || 'N/A'}`;
                } else {
                    document.getElementById('movie-title').textContent = `Phim #${movieId}`;
                }
                
                // === CẬP NHẬT: Render cả ngày, suất chiếu, và combo ===
                renderWeekSelector(movieId);
                renderShowtimes(movieId, selectedDate);
                renderComboSelector(); // <-- THÊM MỚI
                await loadSeatMap(movieId, selectedDate);
                // === Kết thúc CẬP NHẬT ===

                document.getElementById('confirm-booking').addEventListener('click', () => confirmBooking(movieId));

            } catch (err) {
                console.error('Lỗi khởi tạo booking:', err);
            }
        }

        function findMovieInMock(id) {
            const numeric = parseInt(id, 10);
            const allMovies = [mockData.banner, ...mockData.newMovies, ...mockData.trendingMovies];
            return allMovies.find(m => m.id === numeric) || null;
        }

        let currentSeats = [];
        let selectedSeats = [];
        const SEAT_PRICE = 90000;
        let selectedDate = new Date().toISOString().slice(0,10);
        
        // === BIẾN MỚI: Suất chiếu và Combo ===
        let selectedShowtime = '09:30';
        const MOCK_SHOWTIMES = ['09:30', '13:00', '16:30', '19:00', '21:15'];
        
        // Dữ liệu Combo giả lập
        const MOCK_COMBOS = [
            {
                id: 'combo1',
                title: 'Combo 1 Lớn',
                price: 75000,
                description: '1 Bắp Lớn & 1 Nước Lớn',
                imageUrl: 'bapnuoc.jpg' 
            },
            {
                id: 'combo2',
                title: 'Combo 2 Lớn',
                price: 89000,
                description: '1 Bắp Lớn & 2 Nước Lớn',
                imageUrl: 'bapnuoc.jpg' // URL ảnh thật
            }
        ];
        // Biến lưu trữ combo đã chọn
        let selectedCombos = {}; // { combo1: 1, combo2: 0 }
        // === Kết thúc BIẾN MỚI ===


        // HÀM renderWeekSelector (Cập nhật logic click)
        function renderWeekSelector(movieId) {
            const container = document.getElementById('date-selector');
            if (!container) return;
            container.innerHTML = '';

            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const d = new Date(today);
                d.setDate(today.getDate() + i);
                const iso = d.toISOString().slice(0,10);
                
                const weekday = new Intl.DateTimeFormat('vi-VN', { weekday: 'short' }).format(d);
                let dayLabel = weekday;
                if (i === 0) dayLabel = 'Hôm nay';
                if (i === 1) dayLabel = 'Ngày mai';
                const dateLabel = `${d.getDate()}/${d.getMonth()+1}`;
                
                const btn = document.createElement('div');
                btn.className = 'date-item';
                btn.dataset.date = iso;
                btn.innerHTML = `<div style="font-weight:600">${dayLabel}</div><div style="font-size:12px;">${dateLabel}</div>`;
                
                if (iso === selectedDate) btn.classList.add('selected');
                
                btn.addEventListener('click', async () => {
                    const prev = container.querySelector('.date-item.selected');
                    if (prev) prev.classList.remove('selected');
                    btn.classList.add('selected');
                    selectedDate = iso;
                    
                    selectedShowtime = MOCK_SHOWTIMES[0];
                    renderShowtimes(movieId, selectedDate);
                    
                    selectedSeats = [];
                    updateBookingSummary(); // CẬP NHẬT: Gọi hàm summary mới
                    await loadSeatMap(movieId, selectedDate);
                });
                container.appendChild(btn);
            }
        }
        
        // HÀM renderShowtimes (Cập nhật logic click)
        function renderShowtimes(movieId, date) {
            const container = document.getElementById('showtime-selector');
            if (!container) return;
            container.innerHTML = '';

            MOCK_SHOWTIMES.forEach(time => {
                const btn = document.createElement('div');
                btn.className = 'time-item';
                btn.dataset.time = time;
                btn.textContent = time;

                if (time === selectedShowtime) {
                    btn.classList.add('selected');
                }

                btn.addEventListener('click', async () => {
                    const prev = container.querySelector('.time-item.selected');
                    if (prev) prev.classList.remove('selected');
                    btn.classList.add('selected');
                    selectedShowtime = time;
                    
                    selectedSeats = [];
                    updateBookingSummary(); // CẬP NHẬT: Gọi hàm summary mới
                    
                    await loadSeatMap(movieId, selectedDate);
                });
                container.appendChild(btn);
            });
        }
        
        
        /**
         * === HÀM MỚI: renderComboSelector ===
         * Render danh sách combo và gán sự kiện
         */
        function renderComboSelector() {
            const container = document.getElementById('combo-list-container');
            if (!container) return;
            container.innerHTML = '';
            
            MOCK_COMBOS.forEach(combo => {
                const comboId = combo.id;
                // Khởi tạo số lượng
                if (!selectedCombos[comboId]) {
                    selectedCombos[comboId] = 0;
                }
                
                const item = document.createElement('div');
                item.className = 'combo-item';
                item.id = `combo-item-${comboId}`; // Thêm ID để JS tìm
                
                item.innerHTML = `
                    <img src="${combo.imageUrl}" alt="${combo.title}">
                    <div class="combo-info">
                        <h4>${combo.title}</h4>
                        <p>${combo.price.toLocaleString('vi-VN')} VND</p>
                    </div>
                    <div class="combo-quantity-selector">
                        <button class="quantity-btn btn-minus" data-id="${comboId}" ${selectedCombos[comboId] === 0 ? 'disabled' : ''}>-</button>
                        <span class="quantity-display">${selectedCombos[comboId]}</span>
                        <button class="quantity-btn btn-plus" data-id="${comboId}">+</button>
                    </div>
                `;
                container.appendChild(item);
            });
            
            // Gán sự kiện cho các nút (+), (-)
            container.addEventListener('click', (e) => {
                const comboId = e.target.dataset.id;
                if (!comboId) return;
                
                const currentQty = selectedCombos[comboId];
                
                if (e.target.classList.contains('btn-plus')) {
                    selectedCombos[comboId] = currentQty + 1;
                } else if (e.target.classList.contains('btn-minus')) {
                    if (currentQty > 0) {
                        selectedCombos[comboId] = currentQty - 1;
                    }
                }
                
                // Cập nhật số lượng hiển thị
                const itemUI = document.getElementById(`combo-item-${comboId}`);
                if (itemUI) {
                    itemUI.querySelector('.quantity-display').textContent = selectedCombos[comboId];
                    // Vô hiệu hóa nút (-) nếu số lượng là 0
                    itemUI.querySelector('.btn-minus').disabled = selectedCombos[comboId] === 0;
                }
                
                // Cập nhật tổng tiền
                updateBookingSummary();
            });
        }


        // HÀM loadSeatMap (Cập nhật tiêu đề)
        async function loadSeatMap(movieId, date) {
            const container = document.getElementById('seat-map');
            container.innerHTML = 'Đang tải sơ đồ chỗ ngồi...';
            try {
                const q = date ? `?date=${encodeURIComponent(date)}` : '';
                const resp = await fetch(`http://localhost:3000/api/movies/${movieId}/seats${q}`);
                
                if (!resp.ok) throw new Error('Không thể tải dữ liệu ghế');
                const data = await resp.json();
                renderSeatMap(data.rows);
                
                const title = document.getElementById('booking-title');
                if (title && data.date) {
                    const dateObj = new Date(data.date + 'T00:00:00');
                    const dateString = new Intl.DateTimeFormat('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' }).format(dateObj);
                    title.textContent = `Chọn Vé - Ngày ${dateString} | Suất ${selectedShowtime}`;
                }
            } catch (err) {
                console.error(err);
                container.innerHTML = '<p style="color:red">Không thể tải sơ đồ chỗ ngồi. Vui lòng khởi động backend (xem README trong thư mục backend).</p>';
            }
        }

        // HÀM renderSeatMap (Không thay đổi)
        function renderSeatMap(rows) {
            const container = document.getElementById('seat-map');
            container.innerHTML = '';
            currentSeats = [];
            const COLS_PER_ROW = 14;
            const GAP_COLS = [2, 11]; 
            rows.forEach(r => {
                let seatIndex = 0; 
                for (let i = 0; i < COLS_PER_ROW; i++) {
                    if (GAP_COLS.includes(i)) {
                        const gap = document.createElement('div');
                        gap.className = 'seat gap';
                        container.appendChild(gap);
                        continue;
                    }
                    if (seatIndex >= r.seats.length) {
                        const gap = document.createElement('div');
                        gap.className = 'seat gap';
                        container.appendChild(gap);
                        continue;
                    }
                    const s = r.seats[seatIndex];
                    const el = document.createElement('div');
                    el.className = 'seat ' + (s.status === 'booked' ? 'booked' : 'available');
                    el.textContent = `${s.row}${s.col}`;
                    el.dataset.row = s.row;
                    el.dataset.col = s.col;
                    if (s.status !== 'booked') {
                        el.addEventListener('click', onSeatClick);
                    }
                    container.appendChild(el);
                    currentSeats.push({ row: s.row, col: s.col, status: s.status, el });
                    seatIndex++;
                }
            });
            updateBookingSummary(); // CẬP NHẬT: Gọi hàm summary mới
        }

        // HÀM onSeatClick (CẬP NHẬT: Gọi hàm summary mới)
        function onSeatClick(e) {
            const el = e.currentTarget;
            const row = el.dataset.row;
            const col = parseInt(el.dataset.col, 10);
            const key = `${row}${col}`;
            const idx = selectedSeats.findIndex(s => s.key === key);
            if (idx >= 0) {
                selectedSeats.splice(idx, 1);
                el.classList.remove('selected');
            } else {
                selectedSeats.push({ row, col, key });
                el.classList.add('selected');
            }
            updateBookingSummary(); // CẬP NHẬT: Gọi hàm summary mới
        }

        /**
         * === HÀM CẬP NHẬT LỚN: updateBookingSummary ===
         * Thay thế hàm updateSelectedDisplay()
         * Cập nhật cả Ghế, Combo và Tổng tiền
         */
        function updateBookingSummary() {
            let seatTotal = 0;
            let comboTotal = 0;
            
            // 1. Cập nhật Ghế
            const seatListEl = document.getElementById('selected-list');
            const seatTotalEl = document.getElementById('selected-seats-total');
            
            if (selectedSeats.length === 0) {
                seatListEl.textContent = '(chưa chọn)';
                seatTotalEl.textContent = '0 VND';
            } else {
                seatListEl.textContent = selectedSeats.map(s => s.key).join(', ');
                seatTotal = selectedSeats.length * SEAT_PRICE;
                seatTotalEl.textContent = `${seatTotal.toLocaleString('vi-VN')} VND`;
            }

            // 2. Cập nhật Combo
            const comboListEl = document.getElementById('combo-summary-list');
            comboListEl.innerHTML = ''; // Xóa list cũ
            
            let comboHtml = '';
            for (const comboId in selectedCombos) {
                const quantity = selectedCombos[comboId];
                if (quantity > 0) {
                    const comboData = MOCK_COMBOS.find(c => c.id === comboId);
                    if (comboData) {
                        const itemTotal = comboData.price * quantity;
                        comboTotal += itemTotal;
                        comboHtml += `
                            <div class="summary-item">
                                <span>${quantity} x ${comboData.title}</span>
                                <span>${itemTotal.toLocaleString('vi-VN')} VND</span>
                            </div>
                        `;
                    }
                }
            }
            comboListEl.innerHTML = comboHtml;
            
            // Ẩn/Hiện phần combo nếu không có gì
            comboListEl.style.display = comboTotal > 0 ? 'block' : 'none';
            

            // 3. Cập nhật Tổng tiền
            const totalPriceEl = document.getElementById('total-price');
            const finalTotal = seatTotal + comboTotal;
            totalPriceEl.textContent = `${finalTotal.toLocaleString('vi-VN')} VND`;
        }


        /**
         * === HÀM CẬP NHẬT: confirmBooking ===
         * Thêm 'combos' vào payload gửi đi
         */
        async function confirmBooking(movieId) {
            if (selectedSeats.length === 0) {
                window.alert('Vui lòng chọn ít nhất 1 ghế.');
                return;
            }
            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            if (!name || !phone) {
                window.alert('Vui lòng nhập tên và số điện thoại.');
                return;
            }
            
            // Lọc ra các combo có số lượng > 0
            const finalCombos = {};
            for (const comboId in selectedCombos) {
                if (selectedCombos[comboId] > 0) {
                    finalCombos[comboId] = selectedCombos[comboId];
                }
            }

            const seatsPayload = selectedSeats.map(s => ({ row: s.row, col: s.col }));
            try {
                // Thêm 'showtime' và 'combos' vào body
                const resp = await fetch('http://localhost:3000/api/bookings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        movieId, 
                        seats: seatsPayload, 
                        customer: { name, phone }, 
                        date: selectedDate, 
                        showtime: selectedShowtime,
                        combos: finalCombos // <-- THÊM MỚI
                    })
                });

                if (resp.status === 409) {
                    const body = await resp.json();
                    window.alert('Lỗi: Một số ghế đã bị đặt bởi người khác: ' + (body.conflicts || []).join(', '));
                    await loadSeatMap(movieId, selectedDate);
                    selectedSeats = [];
                    updateBookingSummary();
                    return;
                }

                if (!resp.ok) {
                    const body = await resp.text();
                    throw new Error(body || 'Lỗi khi tạo booking');
                }

                const data = await resp.json();
                document.getElementById('booking-message').textContent = 'Đặt vé thành công! Mã booking: ' + data.booking.id;
                
                // Reset sau khi thành công
                selectedSeats = [];
                selectedCombos = {};
                renderComboSelector(); // Render lại combo về 0
                updateBookingSummary();
                await loadSeatMap(movieId, selectedDate);
                
            } catch (err) {
                console.error('Lỗi khi gửi đặt vé:', err);
                window.alert('Lỗi khi gửi đặt vé: ' + (err.message || err));
            }
        }

        // --- CÁC HÀM HELPER (Không thay đổi) ---
        function addHeaderScrollEffect() {
            const header = document.querySelector('.main-header');
            if (!header) return;

            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
        }

        function setupModalListeners() {
            const modal = document.getElementById('trailer-modal');
            const closeBtn = document.getElementById('modal-close-btn');
            const trailerIframe = document.getElementById('trailer-iframe');

            if (!modal || !closeBtn || !trailerIframe) {
                return;
            }

            document.body.addEventListener('click', (event) => {
                const openBtn = event.target.closest('.btn-open-modal');
                if (openBtn) {
                    const url = openBtn.dataset.trailerUrl;
                    if (url) {
                        trailerIframe.src = `${url}?autoplay=1`;
                        modal.classList.add('active');
                    }
                }
            });

            function closeModal() {
                modal.classList.remove('active');
                trailerIframe.src = '';
            }

            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });
        }

        function setupHeaderSearchListeners() {
            const input = document.getElementById('header-search-input');
            const btn = document.getElementById('header-search-btn');
            if (!input || !btn) return;

            function doSearch() {
                const q = input.value.trim();
                if (q === '') {
                    window.location.href = 'movies.html';
                } else {
                    window.location.href = `movies.html?q=${encodeURIComponent(q)}`;
                }
            }

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') doSearch();
            });

            btn.addEventListener('click', doSearch);
        }

    </script>
</body>
</html>